% Hash Collector - alg3
\begin{figure}[t!]
  \begin{adjustbox}{minipage=[t]{\columnwidth}}
    \begin{algorithm}[H]
      \renewcommand{\thealgorithm}{Hash Collector}         
      \caption{}%
      \label{alg:collector-hash}%
      \small
      \begin{algorithmic}[1]
            \State \textbf{Init:} \texttt{batch} $\leftarrow$ \{\}
      
            \Function{\<AddElement>}{$element$}\label{alg:hash_add_tx}
            		\If {\<isValidElement>($element$)}
            			\State \texttt{encoded\_element} $\leftarrow$ \texttt{RLP.Encode}($element$)
					        \State \texttt{batch} $\leftarrow$ \texttt{batch} $\cup$ \{\texttt{encoded\_element}\}
                \EndIf
                \State \textbf{return}
            \EndFunction

            \smallskip

            \When {\<isReady>(\<batch>)}
              \State \texttt{hash} $\leftarrow$  \texttt{Hash}(\texttt{batch})
              \State \texttt{Tendermint.Broadcast}(\texttt{hash})
              %\State \Call{\<reset>}{\null}
              \State \texttt{batch} $\leftarrow$ \{\}
            \EndWhen

            \Function{\<Reverse>}{$h$, $s$}\label{alg:hash_request_tx}
              \If {\texttt{DATA\_BASE}.Get($h$) \texttt{is not null}}
                \State \texttt{batch} = \texttt{DATA\_BASE}.Get($h$)
                \Comment{Obtener el lote de la base de datos local.}
              \Else
                \State \texttt{public\_key} = \<RecoverPK>($s$)
                \State \texttt{collector} = \texttt{BuildCollector(public\_key)}
                \State \texttt{batch} = \texttt{collector}.\Call{\<Reverse>}{$h$, $s$}
                \Comment{Obtener el lote mediante otro collector.}
                \State \texttt{DATA\_BASE}.Set($h$, \texttt{batch})
                \Comment{AÃ±adir la nueva entrada a la base de datos local.}
              \EndIf
              \State \textbf{return} \texttt{batch}
            \EndFunction
            
            % \Function{\<reset>}{\null}\label{alg:hash_reset}
            % 		\State \texttt{batch} $\leftarrow$ \{\}
            %     \State \textbf{return}
            % \EndFunction
        \end{algorithmic}
      \end{algorithm}
	\end{adjustbox}
  \end{figure}
